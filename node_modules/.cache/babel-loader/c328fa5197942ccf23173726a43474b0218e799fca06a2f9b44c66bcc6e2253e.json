{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Button,message,Modal}from\"antd\";import{CloseOutlined}from\"@ant-design/icons\";import axios from\"axios\";import{Gallery}from\"react-grid-gallery\";import{BASE_URL,TOKEN_KEY}from\"../constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const captionStyle={backgroundColor:\"rgba(0, 0, 0, 0.6)\",maxHeight:\"240px\",overflow:\"hidden\",position:\"absolute\",bottom:\"0\",width:\"100%\",color:\"white\",padding:\"2px\",fontSize:\"90%\"};const wrapperStyle={display:\"block\",minHeight:\"1px\",width:\"100%\",border:\"1px solid #ddd\",overflow:\"auto\"};function PhotoGallery(props){const[images,setImages]=useState(props.images);const imageArr=images.map(image=>{return{//拿到Home.js中定义的image的参数， 并展开\n...image,customOverlay:/*#__PURE__*/_jsxs(\"div\",{style:captionStyle,children:[/*#__PURE__*/_jsx(\"div\",{children:\"\".concat(image.user,\": \").concat(image.caption)}),/*#__PURE__*/_jsx(Button,{style:{marginTop:\"10px\",marginLeft:\"5px\"},type:\"primary\",icon:/*#__PURE__*/_jsx(CloseOutlined,{}),size:\"small\",onClick:()=>onDeleteImage(image.postId),children:\"Delete\"},\"deleteImage\")]})};});const onDeleteImage=postId=>{if(window.confirm(\"Confirm to delete this image\")){const newImageArr=images.filter(img=>img.postId!==postId);console.log(\"delete image \",newImageArr);const opt={method:\"DELETE\",url:\"\".concat(BASE_URL,\"/post/\").concat(postId),headers:{Authorization:\"Bearer \".concat(localStorage.getItem(TOKEN_KEY))}};axios(opt).then(res=>{console.log(\"delete result -> \",res);// case1: success\nif(res.status===200){// step1: set state\nsetImages(newImageArr);}}).catch(err=>{// case2: fail\nmessage.error(\"Delete failed!\");console.log(\"fetch posts failed: \",err.message);});}};useEffect(()=>{setImages(props.images);},[props.images]);return/*#__PURE__*/_jsx(\"div\",{style:wrapperStyle,children:/*#__PURE__*/_jsx(Gallery,{images:imageArr,enableImageSelection:false,backdropClosesModal:true})});}export default PhotoGallery;","map":{"version":3,"names":["React","useState","useEffect","Button","message","Modal","CloseOutlined","axios","Gallery","BASE_URL","TOKEN_KEY","jsx","_jsx","jsxs","_jsxs","captionStyle","backgroundColor","maxHeight","overflow","position","bottom","width","color","padding","fontSize","wrapperStyle","display","minHeight","border","PhotoGallery","props","images","setImages","imageArr","map","image","customOverlay","style","children","concat","user","caption","marginTop","marginLeft","type","icon","size","onClick","onDeleteImage","postId","window","confirm","newImageArr","filter","img","console","log","opt","method","url","headers","Authorization","localStorage","getItem","then","res","status","catch","err","error","enableImageSelection","backdropClosesModal"],"sources":["/Users/yuxuan/Desktop/projects/around-web/src/components/PhotoGallery.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Button, message, Modal } from \"antd\";\nimport { CloseOutlined } from \"@ant-design/icons\";\nimport axios from \"axios\";\nimport { Gallery } from \"react-grid-gallery\";\nimport { BASE_URL, TOKEN_KEY } from \"../constants\";\n\n\nconst captionStyle = {\n  backgroundColor: \"rgba(0, 0, 0, 0.6)\",\n  maxHeight: \"240px\",\n  overflow: \"hidden\",\n  position: \"absolute\",\n  bottom: \"0\",\n  width: \"100%\",\n  color: \"white\",\n  padding: \"2px\",\n  fontSize: \"90%\",\n};\n\n\nconst wrapperStyle = {\n  display: \"block\",\n  minHeight: \"1px\",\n  width: \"100%\",\n  border: \"1px solid #ddd\",\n  overflow: \"auto\",\n};\n\n\nfunction PhotoGallery(props) {\n  const [images, setImages] = useState(props.images);\n\n\n  const imageArr = images.map((image) => {\n    return {\n      //拿到Home.js中定义的image的参数， 并展开\n      ...image,\n      customOverlay: (\n        <div style={captionStyle}>\n          <div\n          >{`${image.user}: ${image.caption}`}</div>\n          <Button\n            style={{ marginTop: \"10px\", marginLeft: \"5px\" }}\n            key=\"deleteImage\"\n            type=\"primary\"\n            icon={<CloseOutlined />}\n            size=\"small\"\n            onClick={() => onDeleteImage(image.postId)}\n          >\n            Delete\n          </Button>\n        </div>\n      ),\n    };\n  });\n\n\n  const onDeleteImage = (postId) => {\n    if (window.confirm(`Confirm to delete this image`)) {\n      const newImageArr = images.filter((img) => img.postId !== postId);\n      console.log(\"delete image \", newImageArr);\n      const opt = {\n        method: \"DELETE\",\n        url: `${BASE_URL}/post/${postId}`,\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(TOKEN_KEY)}`,\n        },\n      };\n\n\n      axios(opt)\n        .then((res) => {\n          console.log(\"delete result -> \", res);\n          // case1: success\n          if (res.status === 200) {\n            // step1: set state\n            setImages(newImageArr);\n          }\n        })\n        .catch((err) => {\n          // case2: fail\n          message.error(\"Delete failed!\");\n          console.log(\"fetch posts failed: \", err.message);\n        });\n    }\n  };\n\n\n  useEffect(() => {\n    setImages(props.images);\n  }, [props.images]);\n\n\n  return (\n    <div style={wrapperStyle}>\n      <Gallery\n        images={imageArr}\n        enableImageSelection={false}\n        backdropClosesModal={true}\n      />\n    </div>\n  );\n}\n\n\nPhotoGallery.propTypes = {\n  images: PropTypes.arrayOf(\n    PropTypes.shape({\n      postId: PropTypes.string.isRequired,\n      user: PropTypes.string.isRequired,\n      caption: PropTypes.string.isRequired,\n      src: PropTypes.string.isRequired,\n      thumbnail: PropTypes.string.isRequired,\n      thumbnailWidth: PropTypes.number.isRequired,\n      thumbnailHeight: PropTypes.number.isRequired,\n    })\n  ).isRequired,\n};\n\n\nexport default PhotoGallery;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}